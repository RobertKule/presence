{% extends "core/base_auth.html" %}
{% load static %}

{% block title %}Inscription | EduConnect{% endblock %}

{% block content %}
<div class="d-flex flex-column align-items-center justify-content-center min-vh-100 py-4 px-3">    
        <!-- Sign-up Card -->
    <div class="card shadow-sm border-0 rounded-4 overflow-hidden w-100" style="max-width: 800px;">
        <div class="card-body p-4">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-user-plus me-2"></i> Créer un compte Enseignant
            </h2>

            <form method="post" id="signupForm" class="needs-validation" novalidate>
                {% csrf_token %}

                <div class="row g-4">
                    <!-- Prénom -->
                    <div class="col-md-6">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">
                            <i class="fas fa-user me-1 text-muted"></i> {{ form.first_name.label }}
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Nom -->
                    <div class="col-md-6">
                        <label for="{{ form.last_name.id_for_label }}" class="form-label">
                            <i class="fas fa-user me-1 text-muted"></i> {{ form.last_name.label }}
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div class="col-md-6">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            <i class="fas fa-envelope me-1 text-muted"></i> {{ form.email.label }}
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                {% for error in form.email.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Username -->
                    <div class="col-md-6">
                        <label for="{{ form.username.id_for_label }}" class="form-label">
                            <i class="fas fa-at me-1 text-muted"></i> {{ form.username.label }}
                        </label>
                        {{ form.username }}
                        {% if form.username.errors %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                {% for error in form.username.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Mot de passe -->
                <div class="mt-4">
                    <label for="{{ form.password1.id_for_label }}" class="form-label">
                        <i class="fas fa-lock me-1 text-muted"></i> {{ form.password1.label }}
                    </label>
                    {{ form.password1 }}
                    <div class="password-strength mt-2">
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-danger" id="passwordStrengthBar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                    <small class="text-muted mt-1 d-block">Le mot de passe doit contenir au moins 8 caractères, avec lettres, chiffres et symboles.</small>
                    {% if form.password1.errors %}
                        <div class="text-danger small mt-1">
                            <i class="fas fa-exclamation-circle me-1"></i>
                            {% for error in form.password1.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Confirmation mot de passe -->
                <div class="mt-4">
                    <label for="{{ form.password2.id_for_label }}" class="form-label">
                        <i class="fas fa-lock me-1 text-muted"></i> {{ form.password2.label }}
                    </label>
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                        <div class="text-danger small mt-1">
                            <i class="fas fa-exclamation-circle me-1"></i>
                            {% for error in form.password2.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-primary w-100 py-3 mt-4 position-relative">
                    <span class="position-absolute start-0 ms-3 spinner-border spinner-border-sm d-none" role="status" id="signupSpinner"></span>
                    <span id="signupText"><i class="fas fa-user-plus me-2"></i>S'inscrire</span>
                </button>
            </form>

            <!-- Login Link -->
            <p class="text-center mt-4 text-muted small">
                Déjà inscrit ? 
                <a href="{% url 'core:login' %}" class="text-primary text-decoration-none fw-medium">
                    Se connecter
                </a>
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-4 text-center text-muted small">
        &copy; 2025 EduConnect. Tous droits réservés.
    </footer>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Password Strength
    const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
    const passwordStrengthBar = document.getElementById('passwordStrengthBar');

    if (passwordInput) {
        passwordInput.addEventListener('input', function () {
            const password = this.value;
            let score = 0;

            if (password.length >= 8) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            if (password.length >= 12) score++;

            const width = score * 20;
            passwordStrengthBar.style.width = `${width}%`;

            if (score < 3) {
                passwordStrengthBar.className = 'progress-bar bg-danger';
            } else if (score < 5) {
                passwordStrengthBar.className = 'progress-bar bg-warning';
            } else {
                passwordStrengthBar.className = 'progress-bar bg-success';
            }
        });
    }

    // Form Submit Animation
    const signupForm = document.getElementById('signupForm');
    const signupSpinner = document.getElementById('signupSpinner');
    const signupText = document.getElementById('signupText');

    signupForm.addEventListener('submit', function () {
        signupSpinner.classList.remove('d-none');
        signupText.textContent = 'Création du compte...';
        signupForm.querySelector('button').disabled = true;
    });
</script>
{% endblock %}