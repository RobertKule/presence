{% extends "core/base.html" %}
{% load static %}

{% block title %}Séances | EduConnect{% endblock %}

{% block header %}
    <i class="fas fa-calendar-alt me-2"></i> Mes Séances
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Filtres -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-6">
                    <label for="cours" class="form-label">Filtrer par cours</label>
                    <select name="cours" id="cours" class="form-select" onchange="this.form.submit()">
                        <option value="">Tous les cours</option>
                        {% for c in cours_options %}
                            <option value="{{ c.pk }}" {% if c.pk|stringformat:"s" == request.GET.cours %}selected{% endif %}>
                                {{ c.nom }} - {{ c.classe.nom }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <a href="{% url 'core:seance_create' %}" class="btn btn-primary px-4 ms-auto d-flex align-items-center gap-2">
                        <i class="fas fa-plus-circle"></i> Nouvelle Séance
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Liste des séances -->
    {% if seances %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Cours</th>
                        <th>Classe</th>
                        <th>Date</th>
                        <th>Heure</th>
                        <th>Salle</th>
                        <th>Présence</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in seances %}
                        <tr>
                            <td><strong>{{ s.cours.nom }}</strong></td>
                            <td>{{ s.cours.classe.nom }}</td>
                            <td>{{ s.date|date:"d/m/Y" }}</td>
                            <td>{{ s.heure_debut|time:"H:i" }} → {{ s.heure_fin|time:"H:i" }}</td>
                            <td>{{ s.salle|default:"—" }}</td>
                            <td>
    <span class="badge bg-{% if s.taux_presence|add:0 >= 75 %}success{% else %}danger{% endif %} rounded-pill">
        {{ s.taux_presence|floatformat:0 }}%
    </span>
</td>
                            <td>
                                <div class="btn-group">
                                    <a href="{% url 'core:appel_presence' s.pk %}" class="btn btn-sm btn-outline-primary" title="Appel">
                                        <i class="fas fa-user-check"></i>
                                    </a>
                                    <a href="{% url 'core:seance_update' s.pk %}" class="btn btn-sm btn-outline-warning" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{% url 'core:seance_delete' s.pk %}" class="btn btn-sm btn-outline-danger" title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if seances.has_other_pages %}
            <nav aria-label="Pagination" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if seances.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?cours={{ request.GET.cours }}&page={{ seances.previous_page_number }}">← Précédent</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">← Précédent</span></li>
                    {% endif %}

                    {% for num in seances.paginator.page_range %}
                        {% if seances.number == num %}
                            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?cours={{ request.GET.cours }}&page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if seances.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?cours={{ request.GET.cours }}&page={{ seances.next_page_number }}">Suivant →</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Suivant →</span></li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}

    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-calendar-slash text-muted" style="font-size: 5rem; opacity: 0.3;"></i>
            <h4 class="text-muted mt-3">Aucune séance pour l'instant</h4>
            <p class="text-muted mb-4">Planifiez votre première séance pour commencer à gérer les présences.</p>
            <a href="{% url 'core:seance_create' %}" class="btn btn-lg btn-primary px-5">
                <i class="fas fa-plus-circle me-2"></i> Créer une séance
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}