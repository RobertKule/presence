<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Statistiques de Présence</title>
</head>
<body style="font-family: Arial, sans-serif; font-size: 12px; color: #333; margin: 0; padding: 10px;">
    <h2 style="text-align: center; margin-bottom: 20px;">Statistiques de Présence</h2>

    {% if stats %}
        {% for s in stats %}
            <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 15px; page-break-inside: avoid;">
                <div style="font-weight: bold; margin-bottom: 10px; font-size: 14px;">
                    {{ s.cours.nom }} - {{ s.cours.classe.nom }} ({{ s.total_seances }} séances)
                </div>
                <div>
                    <h6 style="margin: 5px 0;">Statistiques globales</h6>
                    <div style="display: table; width: 100%; text-align: center; margin-bottom: 10px;">
                        <div style="display: table-cell; width: 25%;"><strong>{{ s.global.present }}</strong><br>Présents</div>
                        <div style="display: table-cell; width: 25%;"><strong>{{ s.global.retard }}</strong><br>Retards</div>
                        <div style="display: table-cell; width: 25%;"><strong>{{ s.global.absent }}</strong><br>Absents</div>
                        <div style="display: table-cell; width: 25%;"><strong>{{ s.global.motif }}</strong><br>Motif</div>
                    </div>

                    <h6 style="margin: 15px 0 5px 0;">Taux de présence par étudiant</h6>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                        <thead>
                            <tr>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Étudiant</th>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Présent</th>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Retard</th>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Absent</th>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Motif</th>
                                <th style="border: 1px solid #ccc; padding: 5px; background-color: #f0f0f0; text-align: center;">Taux</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for etu in s.etudiants_stats %}
                                <tr>
                                    <td style="border: 1px solid #ccc; padding: 5px;">{{ etu.etudiant.get_full_name }}</td>
                                    <td style="border: 1px solid #ccc; padding: 5px; text-align: center;">{{ etu.present }}</td>
                                    <td style="border: 1px solid #ccc; padding: 5px; text-align: center;">{{ etu.retard }}</td>
                                    <td style="border: 1px solid #ccc; padding: 5px; text-align: center;">{{ etu.absent }}</td>
                                    <td style="border: 1px solid #ccc; padding: 5px; text-align: center;">{{ etu.motif }}</td>
                                    <td style="border: 1px solid #ccc; padding: 5px; text-align: center;">
                                        {% if etu.taux_presence >= 75 %}
                                            <span style="display: inline-block; padding: 3px 6px; border-radius: 4px; color: white; background-color: green; font-size: 0.85em;">{{ etu.taux_presence|floatformat:0 }}%</span>
                                        {% else %}
                                            <span style="display: inline-block; padding: 3px 6px; border-radius: 4px; color: white; background-color: red; font-size: 0.85em;">{{ etu.taux_presence|floatformat:0 }}%</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div style="text-align: center; padding: 30px 0;">
            <h4 style="margin: 5px 0;">Aucune donnée disponible</h4>
            <p>Aucun cours n'a encore de séances ou de présences enregistrées.</p>
        </div>
    {% endif %}
</body>
</html>