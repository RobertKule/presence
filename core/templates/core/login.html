{% extends "core/base_auth.html" %}
{% load static %}

{% block title %}Connexion | EduConnect{% endblock %}

{% block content %}
<div class="d-flex flex-column align-items-center justify-content-center min-vh-100 py-4 px-3" style="background: var(--bg);">
    <!-- Login Card -->
    <div class="card shadow-sm border-0 rounded-4 overflow-hidden w-100" style="max-width: 480px; background: var(--card-bg); border-color: var(--border) !important;">
        <div class="card-body p-4">
            <h2 class="text-center mb-4 text-primary">
                <i class="fas fa-sign-in-alt me-2"></i> Connexion
            </h2>

            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- Username Field -->
                <div class="mb-3">
                    <label for="id_username" class="form-label fw-medium">
                        <i class="fas fa-user me-1 text-muted"></i> Nom d'utilisateur ou email
                    </label>
                    <input type="text" name="username" id="id_username" 
                           class="form-control form-control-lg" 
                           placeholder="Votre nom d'utilisateur ou email"
                           required
                           style="background: var(--card-bg); color: var(--text); border-color: var(--border);">
                    {% if form.username.errors %}
                        <div class="text-danger small mt-1">
                            <i class="fas fa-exclamation-circle me-1"></i>
                            {% for error in form.username.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Password Field -->
                <div class="mb-3">
                    <label for="id_password" class="form-label fw-medium">
                        <i class="fas fa-lock me-1 text-muted"></i> Mot de passe
                    </label>
                    <div class="input-group">
                        <input type="password" name="password" id="id_password" 
                               class="form-control form-control-lg" 
                               placeholder="Votre mot de passe"
                               required
                               style="background: var(--card-bg); color: var(--text); border-color: var(--border);">
                        <button class="btn btn-outline-secondary" type="button" id="togglePassword" 
                                style="background: var(--card-bg); border-color: var(--border); color: var(--text);">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    {% if form.password.errors %}
                        <div class="text-danger small mt-1">
                            <i class="fas fa-exclamation-circle me-1"></i>
                            {% for error in form.password.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary w-100 py-2 mt-3 position-relative" 
                        style="background: var(--primary); border: none; font-size: 1.1rem;">
                    <span class="position-absolute start-0 ms-3 spinner-border spinner-border-sm d-none" role="status" id="loginSpinner"></span>
                    <span id="loginText">Se connecter</span>
                </button>
            </form>

            <!-- Sign-up Link -->
            <p class="text-center mt-4 text-muted small">
                Pas encore de compte ? 
                <a href="{% url 'core:signup' %}" class="text-primary text-decoration-none fw-medium">
                    S'inscrire
                </a>
            </p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-4 text-center text-muted small">
        &copy; 2025 EduConnect. Tous droits réservés.
    </footer>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Password Toggle
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('id_password');
    const eyeIcon = togglePassword.querySelector('i');

    togglePassword.addEventListener('click', function () {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        eyeIcon.classList.toggle('fa-eye');
        eyeIcon.classList.toggle('fa-eye-slash');
    });

    // Login Animation
    const loginForm = document.querySelector('form');
    const loginSpinner = document.getElementById('loginSpinner');
    const loginText = document.getElementById('loginText');

    if (loginForm) {
        loginForm.addEventListener('submit', function () {
            loginSpinner.classList.remove('d-none');
            loginText.textContent = 'Connexion...';
            loginForm.querySelector('button').disabled = true;
        });
    }

    // Input Focus Effect
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('focus', () => {
            input.style.borderColor = 'var(--primary)';
            input.style.boxShadow = '0 0 0 0.2rem rgba(79, 70, 229, 0.25)';
        });
        input.addEventListener('blur', () => {
            input.style.borderColor = 'var(--border)';
            input.style.boxShadow = 'none';
        });
    });

    // Form Validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    // Auto-focus
    document.addEventListener('DOMContentLoaded', function() {
        const usernameInput = document.getElementById('id_username');
        if (usernameInput) usernameInput.focus();
    });
</script>
{% endblock %}